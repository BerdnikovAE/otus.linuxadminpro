# ДЗ 18. Разворачиваем сетевую лабораторию

## Дано
https://github.com/erlong15/otus-linux/tree/network
(ветка network)

Vagrantfile с начальным  построением сети
- inetRouter
- centralRouter
- centralServer

## Планируемая архитектура
построить следующую архитектуру

Сеть office1
- 192.168.2.0/26      - dev
- 192.168.2.64/26    - test servers
- 192.168.2.128/26  - managers
- 192.168.2.192/26  - office hardware

Сеть office2
- 192.168.1.0/25      - dev
- 192.168.1.128/26  - test servers
- 192.168.1.192/26  - office hardware


Сеть central
- 192.168.0.0/28    - directors
- 192.168.0.32/28  - office hardware
- 192.168.0.64/26  - wifi

```
оffice1Server --- office1Router --\ 
                                   CentralRouter --- inetRouter --> internet
оffice2Server --- office2Router --/       \
                                           CentralServer
```
Итого должны получится следующие сервера
- inetRouter
- centralRouter
- office1Router
- office2Router
- centralServer
- office1Server
- office2Server

## Теоретическая часть
- Найти свободные подсети
- Посчитать сколько узлов в каждой подсети, включая свободные
- Указать broadcast адрес для каждой подсети
- проверить нет ли ошибок при разбиении

## Практическая часть
- Соединить офисы в сеть согласно схеме и настроить роутинг
- Все сервера и роутеры должны ходить в инет черз inetRouter
- Все сервера должны видеть друг друга
- у всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи
- при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс


## Решение 
1. Посчитать сколько узлов, минимальный/максимальный адрес - ipcalc 
```sh
#Сеть office1
- 192.168.2.0/26   - of1-dev
      Address:   192.168.2.0          11000000.10101000.00000010.00 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.2.0/26       11000000.10101000.00000010.00 000000
      HostMin:   192.168.2.1          11000000.10101000.00000010.00 000001
      HostMax:   192.168.2.62         11000000.10101000.00000010.00 111110
      Broadcast: 192.168.2.63         11000000.10101000.00000010.00 111111
      Hosts/Net: 62                    Class C, Private Internet
- 192.168.2.64/26  - of1-test
      Address:   192.168.2.64         11000000.10101000.00000010.01 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.2.64/26      11000000.10101000.00000010.01 000000
      HostMin:   192.168.2.65         11000000.10101000.00000010.01 000001
      HostMax:   192.168.2.126        11000000.10101000.00000010.01 111110
      Broadcast: 192.168.2.127        11000000.10101000.00000010.01 111111
      Hosts/Net: 62                    Class C, Private Internet
- 192.168.2.128/26 - of1-mng
      Address:   192.168.2.128        11000000.10101000.00000010.10 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.2.128/26     11000000.10101000.00000010.10 000000
      HostMin:   192.168.2.129        11000000.10101000.00000010.10 000001
      HostMax:   192.168.2.190        11000000.10101000.00000010.10 111110
      Broadcast: 192.168.2.191        11000000.10101000.00000010.10 111111
      Hosts/Net: 62                    Class C, Private Internet
- 192.168.2.192/26 - of1-hw
      Address:   192.168.2.192        11000000.10101000.00000010.11 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.2.192/26     11000000.10101000.00000010.11 000000
      HostMin:   192.168.2.193        11000000.10101000.00000010.11 000001
      HostMax:   192.168.2.254        11000000.10101000.00000010.11 111110
      Broadcast: 192.168.2.255        11000000.10101000.00000010.11 111111
      Hosts/Net: 62                    Class C, Private Internet


#Сеть office2
- 192.168.1.0/25    - of2-dev
      Address:   192.168.1.0          11000000.10101000.00000001.0 0000000
      Netmask:   255.255.255.128 = 25 11111111.11111111.11111111.1 0000000
      Wildcard:  0.0.0.127            00000000.00000000.00000000.0 1111111
      =>
      Network:   192.168.1.0/25       11000000.10101000.00000001.0 0000000
      HostMin:   192.168.1.1          11000000.10101000.00000001.0 0000001
      HostMax:   192.168.1.126        11000000.10101000.00000001.0 1111110
      Broadcast: 192.168.1.127        11000000.10101000.00000001.0 1111111
      Hosts/Net: 126                   Class C, Private Internet
- 192.168.1.128/26  - of2-test
      Address:   192.168.1.128        11000000.10101000.00000001.10 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.1.128/26     11000000.10101000.00000001.10 000000
      HostMin:   192.168.1.129        11000000.10101000.00000001.10 000001
      HostMax:   192.168.1.190        11000000.10101000.00000001.10 111110
      Broadcast: 192.168.1.191        11000000.10101000.00000001.10 111111
      Hosts/Net: 62                    Class C, Private Internet
- 192.168.1.192/26  - of2-hw
      Address:   192.168.1.192        11000000.10101000.00000001.11 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.1.192/26     11000000.10101000.00000001.11 000000
      HostMin:   192.168.1.193        11000000.10101000.00000001.11 000001
      HostMax:   192.168.1.254        11000000.10101000.00000001.11 111110
      Broadcast: 192.168.1.255        11000000.10101000.00000001.11 111111
      Hosts/Net: 62                    Class C, Private Internet

#Сеть central
- 192.168.255.0/30 - router-net
      Address:   192.168.255.0        11000000.10101000.11111111.000000 00
      Netmask:   255.255.255.252 = 30 11111111.11111111.11111111.111111 00
      Wildcard:  0.0.0.3              00000000.00000000.00000000.000000 11
      =>
      Network:   192.168.255.0/30     11000000.10101000.11111111.000000 00
      HostMin:   192.168.255.1        11000000.10101000.11111111.000000 01
      HostMax:   192.168.255.2        11000000.10101000.11111111.000000 10
      Broadcast: 192.168.255.3        11000000.10101000.11111111.000000 11
      Hosts/Net: 2                     Class C, Private Internet
- 192.168.0.0/28   - dir-net
      Address:   192.168.0.0          11000000.10101000.00000000.0000 0000
      Netmask:   255.255.255.240 = 28 11111111.11111111.11111111.1111 0000
      Wildcard:  0.0.0.15             00000000.00000000.00000000.0000 1111
      =>
      Network:   192.168.0.0/28       11000000.10101000.00000000.0000 0000
      HostMin:   192.168.0.1          11000000.10101000.00000000.0000 0001
      HostMax:   192.168.0.14         11000000.10101000.00000000.0000 1110
      Broadcast: 192.168.0.15         11000000.10101000.00000000.0000 1111
      Hosts/Net: 14                    Class C, Private Internet
- 192.168.0.32/28  - hw-net
      Address:   192.168.0.32         11000000.10101000.00000000.0010 0000
      Netmask:   255.255.255.240 = 28 11111111.11111111.11111111.1111 0000
      Wildcard:  0.0.0.15             00000000.00000000.00000000.0000 1111
      =>
      Network:   192.168.0.32/28      11000000.10101000.00000000.0010 0000
      HostMin:   192.168.0.33         11000000.10101000.00000000.0010 0001
      HostMax:   192.168.0.46         11000000.10101000.00000000.0010 1110
      Broadcast: 192.168.0.47         11000000.10101000.00000000.0010 1111
      Hosts/Net: 14                    Class C, Private Internet
- 192.168.0.64/26  - mgt-net
      Address:   192.168.0.64         11000000.10101000.00000000.01 000000
      Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
      Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
      =>
      Network:   192.168.0.64/26      11000000.10101000.00000000.01 000000
      HostMin:   192.168.0.65         11000000.10101000.00000000.01 000001
      HostMax:   192.168.0.126        11000000.10101000.00000000.01 111110
      Broadcast: 192.168.0.127        11000000.10101000.00000000.01 111111
      Hosts/Net: 62                    Class C, Private Internet
- 192.168.10.0/30   - of2-route
      Address:   192.168.10.0         11000000.10101000.00001010.000000 00
      Netmask:   255.255.255.252 = 30 11111111.11111111.11111111.111111 00
      Wildcard:  0.0.0.3              00000000.00000000.00000000.000000 11
      =>
      Network:   192.168.10.0/30      11000000.10101000.00001010.000000 00
      HostMin:   192.168.10.1         11000000.10101000.00001010.000000 01
      HostMax:   192.168.10.2         11000000.10101000.00001010.000000 10
      Broadcast: 192.168.10.3         11000000.10101000.00001010.000000 11
      Hosts/Net: 2                     Class C, Private Internet
- 192.168.20.0/30  - of1-route
      Address:   192.168.20.0         11000000.10101000.00010100.000000 00
      Netmask:   255.255.255.252 = 30 11111111.11111111.11111111.111111 00
      Wildcard:  0.0.0.3              00000000.00000000.00000000.000000 11
      =>
      Network:   192.168.20.0/30      11000000.10101000.00010100.000000 00
      HostMin:   192.168.20.1         11000000.10101000.00010100.000000 01
      HostMax:   192.168.20.2         11000000.10101000.00010100.000000 10
      Broadcast: 192.168.20.3         11000000.10101000.00010100.000000 11
      Hosts/Net: 2                     Class C, Private Internet
```

2. Виртуальная лаба развертывается через [Vagrantfile](Vagrantfile)

3. Проверка 
```sh
#office1Server
[vagrant@office1Server ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=103 time=44.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=103 time=46.8 ms

[vagrant@office1Server ~]$ tracepath -n 8.8.8.8
 1?: [LOCALHOST]                                         pmtu 1500
 1:  192.168.2.1                                           0.328ms
 1:  192.168.2.1                                           0.207ms
 2:  192.168.22.1                                          0.375ms
 3:  192.168.255.1                                         0.469ms
 4:  no reply

#office2Server
[vagrant@office2Server ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=103 time=44.6 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=103 time=46.8 ms

 [vagrant@office2Server ~]$ tracepath -n 8.8.8.8
 1?: [LOCALHOST]                                         pmtu 1500
 1:  192.168.1.1                                           0.377ms
 1:  192.168.1.1                                           0.288ms
 2:  192.168.11.1                                          0.548ms
 3:  192.168.255.1                                         0.532ms
 4:  no reply